coredns:
  isClusterService: false
  serviceType: LoadBalancer
  service:
    annotations:
      # Kann nicht auf selbe IP wie Ingress assigned werden von Kube-VIP.
      # Wenn hier die gleiche IP angegeben wird passiert folgendes:
      # Ein Node bekommt das Lease im namespace ingress-nginx/kubevip-ingress-public-ingress-nginx-controller
      # aber ein anderer Node bekommt das Lease networking/kubevip-networking-coredns
      # und wieder ein anderer bekommt das Lease gitea/kubevip-gitea-ssh
      kube-vip.io/loadbalancerIPs: 192.168.2.92

  # Default zone is what Kubernetes recommends:
  # https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#coredns-configmap-options
  servers:
    - zones:
        - zone: .
      port: 53
      # -- expose the service on a different port
      # servicePort: 5353
      # If serviceType is nodePort you can specify nodePort here
      # nodePort: 30053
      # hostPort: 53
      plugins:
        - name: errors
        # Serves a /health endpoint on :8080, required for livenessProbe
        - name: health
          configBlock: |-
            lameduck 5s
        # Serves a /ready endpoint on :8181, required for readinessProbe
        - name: ready
        # Serves a /metrics endpoint on :9153, required for serviceMonitor
        - name: prometheus
          parameters: 0.0.0.0:9153

        - name: cache
          parameters: 30
        - name: loop
        - name: reload
        - name: loadbalance
        # Limit to local hostnames and don't fall through for arpa domains. This should prevent grabbing public dns entries.
        # But allow fallthrough for public domains (so that *.mon. domains can be reached)
        - name: etcd
          parameters: home.arpa felix-prasse.de
          configBlock: |-
            fallthrough felix-prasse.de
            path /skydns
            endpoint http://etcd:2379
        - name: forward
          parameters: felix-prasse.de 1.1.1.1
        - name: forward
          parameters: . /etc/resolv.conf